# Отравление сброса пароля
Отравление сбросом пароля - это метод, с помощью которого злоумышленник манипулирует уязвимым веб-сайтом, создавая ссылку для сброса пароля, указывающую на домен, находящийся под их контролем. Такое поведение может быть использовано для кражи секретных токенов, необходимых для сброса паролей произвольных пользователей, и, в конечном счете, для компрометации их учетных записей.

![](https://portswigger.net/web-security/images/password-reset-poisoning.svg)
## Как работает сброс пароля?
Практически все веб-сайты, требующие входа в систему, также реализуют функциональность, позволяющую пользователям сбросить свой пароль, если они его забудут. Существует несколько способов сделать это с разной степенью безопасности и практичности. Один из наиболее распространенных подходов выглядит примерно так:

1. Пользователь вводит свое имя пользователя или адрес электронной почты и отправляет запрос на сброс пароля.
2. Веб-сайт проверяет, существует ли этот пользователь, а затем генерирует временный уникальный токен с высокой энтропией, который он связывает с учетной записью пользователя на внутреннем сервере.
3. Веб-сайт отправляет пользователю электронное письмо, содержащее ссылку для сброса пароля. Уникальный токен сброса пользователя включается в качестве параметра запроса в соответствующий URL-адрес:
``` 
https://normal-website.com/reset?token=0a1b2c3d4e5f6g7h8i9j
```
4. Когда пользователь посещает этот URL-адрес, веб-сайт проверяет, действителен ли предоставленный токен, и использует его для определения того, какая учетная запись сбрасывается. Если все идет так, как ожидалось, пользователю предоставляется возможность ввести новый пароль. Наконец, токен уничтожается.

Этот процесс достаточно прост и относительно безопасен по сравнению с некоторыми другими подходами. Однако его безопасность основана на принципе, согласно которому только предполагаемый пользователь имеет доступ к своему почтовому ящику и, следовательно, к своему уникальному токену. Отравление сброса пароля - это способ кражи этого токена с целью изменения пароля другого пользователя.
## Как создать атаку с отравлением сброса пароля
Если URL-адрес, отправляемый пользователю, динамически генерируется на основе управляемого ввода, такого как заголовок хоста, может быть возможно создать атаку с отравлением сбросом пароля следующим образом:
1. Злоумышленник получает адрес электронной почты или имя пользователя жертвы, если это необходимо, и отправляет запрос на сброс пароля от их имени. При отправке формы они перехватывают полученный HTTP-запрос и изменяют заголовок хоста так, чтобы он указывал на домен, которым они управляют. Для этого примера мы будем использовать *evil-user.net*.
2. Жертва получает подлинное электронное письмо для сброса пароля непосредственно с веб-сайта. Похоже, что оно содержит обычную ссылку для сброса их пароля и, что особенно важно, содержит действительный токен сброса пароля, связанный с их учетной записью. Однако доменное имя в URL-адресе указывает на сервер злоумышленника:
```
https://evil-user.net/reset?token=0a1b2c3d4e5f6g7h8i9j
```
3. Если жертва нажмет на эту ссылку (или она будет получена каким-либо другим способом, например, с помощью антивирусного сканера), токен сброса пароля будет доставлен на сервер злоумышленника.
4. Теперь злоумышленник может посетить реальный URL-адрес уязвимого веб-сайта и указать украденный токен жертвы с помощью соответствующего параметра. Затем он сможет сбросить пароль пользователя на тот, что ему нравится, и впоследствии войти в его учетную запись.

В реальной атаке злоумышленник может попытаться увеличить вероятность того, что жертва перейдет по ссылке, например, сначала разогрев их с помощью поддельного уведомления о нарушении.

Даже если вы не можете управлять ссылкой для сброса пароля, иногда вы можете использовать заголовок хоста для вставки HTML-кода в конфиденциальные электронные письма. Обратите внимание, что почтовые клиенты обычно не выполняют JavaScript, но другие методы внедрения HTML, такие как атаки с висячей разметкой, все еще могут применяться.
