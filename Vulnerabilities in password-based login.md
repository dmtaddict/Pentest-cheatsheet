# Уязвимости входа на основе паролей
Для веб-сайтов, которые используют процесс входа на основе пароля, пользователи либо сами регистрируют учетную запись, либо администратор назначает им учетную запись. Эта учетная запись связана с уникальным именем пользователя и секретным паролем, которые пользователь вводит в форму входа для аутентификации.

В этом случае сам факт того, что они знают секретный пароль, считается достаточным доказательством личности пользователя. Следовательно, безопасность веб-сайта будет поставлена под угрозу, если злоумышленник сможет либо получить, либо угадать учетные данные для входа другого пользователя.

Этого можно достичь различными способами, как мы рассмотрим ниже.
## Атака грубой силой
Атака методом грубой силы-это когда злоумышленник использует систему проб и ошибок в попытке угадать действительные учетные данные пользователя. Эти атаки обычно автоматизируются с использованием словарей с именами пользователей и паролями. Автоматизация этого процесса, особенно с использованием специальных инструментов, потенциально позволяет злоумышленнику совершать огромное количество попыток входа в систему с высокой скоростью.

*Brute-force* - это не всегда просто случай совершенно случайных догадок об именах пользователей и паролях. Используя также базовую логику или общедоступные знания, злоумышленники могут точно настроить атаки методом грубой силы, чтобы сделать гораздо более обоснованные предположения. Это значительно повышает эффективность таких атак. Веб-сайты, которые полагаются на логин на основе пароля в качестве единственного метода аутентификации пользователей, могут быть очень уязвимыми, если они не реализуют достаточную защиту от грубой силы.
### *Brute-force* имен пользователей
Имена пользователей особенно легко угадать, если они соответствуют узнаваемому шаблону, например адресу электронной почты. Например, очень часто можно увидеть бизнес-логины в формате *firstname.lastname@somecompany.com*. Однако, даже если нет очевидной закономерности, иногда даже учетные записи с высокими привилегиями создаются с использованием предсказуемых имен пользователей, таких как *Admin* или *Administrator*.

Во время аудита проверьте, раскрывает ли веб-сайт имена потенциальных пользователей публично. Например, можете ли вы получить доступ к профилям пользователей без входа в систему? Даже если фактическое содержимое профилей скрыто, имя, используемое в профиле, иногда совпадает с именем пользователя для входа. Вам также следует проверить HTTP-ответы, чтобы узнать, указаны ли какие-либо адреса электронной почты. Иногда ответы содержат адреса электронной почты пользователей с высокими привилегиями, таких как администраторы и ИТ-служба поддержки.
### *Brute-force* паролей
Пароли также могут быть забручены, причем сложность зависит от надежности пароля. Многие веб-сайты используют ту или иную форму политики паролей, которая вынуждает пользователей создавать пароли с высокой энтропией, которые, по крайней мере теоретически, сложнее взломать с помощью только грубой силы. Обычно политика включает в себя:
* Минимальное количество символов
* Смесь строчных и прописных букв
* По крайней мере, один специальный символ

Однако, хотя пароли с высокой энтропией трудно взломать только одним компьютером, мы можем использовать базовые знания о поведении человека, чтобы использовать уязвимости, которые пользователи невольно вводят в эту систему. Вместо того чтобы создавать надежный пароль со случайной комбинацией символов, пользователи часто берут пароль, который они могут запомнить, и пытаются подогнать его под политику паролей. Например, если *mypassword* не разрешен, пользователи могут попробовать что-то вроде *Mypassword1!* или вместо этого *Myp4$$w0rd*.

В тех случаях, когда политика требует, чтобы пользователи регулярно меняли свои пароли, пользователи также часто просто вносят незначительные, предсказуемые изменения в предпочитаемый пароль. Например, *Mypassword1!* становится *Mypassword1?* или *Mypassword2!*.

Это знание вероятных учетных данных и предсказуемых шаблонов означает, что атаки методом грубой силы часто могут быть гораздо более сложными и, следовательно, эффективными, чем простое повторение всех возможных комбинаций символов.
### Перечисление имен пользователей
Перечисление имен пользователей-это когда злоумышленник может наблюдать за изменениями в поведении веб-сайта, чтобы определить, является ли данное имя пользователя действительным.

Перечисление имен пользователей обычно происходит либо на странице входа в систему, например, когда вы вводите действительное имя пользователя, но неверный пароль, либо в регистрационных формах, когда вы вводите имя пользователя, которое уже занято. Это значительно сокращает время и усилия, необходимые для принудительного входа в систему, поскольку злоумышленник может быстро сгенерировать короткий список допустимых имен пользователей.

При попытке принудительного взлома страницы входа в систему вам следует обратить особое внимание на любые различия в:
* **Статус коды**: Во время атаки методом грубой силы возвращаемый код состояния HTTP, скорее всего, будет одинаковым для подавляющего большинства предположений, потому что большинство из них будут неверными. Если предположение возвращает другой код статуса, это явный признак того, что имя пользователя было правильным. Для веб-сайтов рекомендуется всегда возвращать один и тот же код статуса независимо от результата, но эта практика не всегда соблюдается.
* **Сообщения об ошибках**: Иногда возвращаемое сообщение об ошибке отличается в зависимости от того, неверны ли имя пользователя и пароль или неверен только пароль. В обоих случаях веб-сайтам рекомендуется использовать одинаковые общие сообщения, но иногда возникают небольшие ошибки при вводе текста. Всего один символ не на своем месте делает два сообщения отличными друг от друга, даже в тех случаях, когда символ не виден на отображаемой странице.
* **Время отклика**: Если большинство запросов обрабатывались с одинаковым временем отклика, любые отклонения от этого предполагают, что за кулисами происходило что-то другое. 
 
Это еще один признак того, что угаданное имя пользователя может быть правильным. Например, веб-сайт может проверять правильность пароля только в том случае, если имя пользователя является действительным. Этот дополнительный шаг может привести к небольшому увеличению времени отклика. Это может быть незаметно, но злоумышленник может сделать эту задержку более очевидной, введя чрезмерно длинный пароль, обработка которого на веб-сайте занимает заметно больше времени.
## Неправильная защита от грубой силы
Весьма вероятно, что атака методом грубой силы будет включать множество неудачных попыток, прежде чем злоумышленник успешно взломает учетную запись. Логично, что защита методом грубой силы направлена на то, чтобы максимально упростить автоматизацию процесса и снизить скорость, с которой злоумышленник может пытаться войти в систему. Двумя наиболее распространенными способами предотвращения атак грубой силы являются:
* Блокировка учетной записи, к которой пытается получить доступ удаленный пользователь, если он предпринимает слишком много неудачных попыток входа в систему
* Блокировка IP-адреса удаленного пользователя, если он делает слишком много попыток входа в систему с высокой частотой

Оба подхода обеспечивают различную степень защиты, но ни один из них не является неуязвимым, особенно если он реализован с использованием ошибочной логики.

Например, иногда вы можете обнаружить, что ваш IP-адрес заблокирован, если вы не входите в систему слишком много раз. В некоторых реализациях счетчик количества неудачных попыток сбрасывается, если владелец IP успешно входит в систему. Это означает, что злоумышленнику просто придется входить в свою учетную запись каждые несколько попыток, чтобы предотвратить достижение этого предела.

В этом случае простого включения ваших собственных учетных данных для входа через регулярные промежутки времени в список слов достаточно, чтобы сделать эту защиту практически бесполезной.
### Блокировка аккаунта
Одним из способов, с помощью которого веб-сайты пытаются предотвратить *brute-force*, является блокировка учетной записи при соблюдении определенных подозрительных критериев, обычно определенного количества неудачных попыток входа в систему. Как и в случае обычных ошибок входа, ответы сервера, указывающие на то, что учетная запись заблокирована, также могут помочь злоумышленнику перечислить имена пользователей.

Блокировка учетной записи обеспечивает определенную степень защиты от целенаправленного взлома конкретной учетной записи. Однако этот подход не позволяет адекватно предотвратить атаки методом грубой силы, при которых злоумышленник просто пытается получить доступ к любой случайной учетной записи, которую он может.

Например, для обхода такого рода защиты можно использовать следующий метод:
1. Составьте список имен пользователей-кандидатов, которые, скорее всего, будут действительными. Это может быть путем перечисления имен пользователей или просто на основе списка общих имен пользователей.
1. Выберите очень небольшой список паролей, которые, по вашему мнению, могут быть у хотя бы одного пользователя. Важно отметить, что количество выбранных вами паролей не должно превышать количество разрешенных попыток входа в систему. Например, если вы определили, что ограничение составляет 3 попытки, вам нужно выбрать максимум 3 варианта пароля.
1. Используя такой инструмент, как Burp Intruder, попробуйте каждый из выбранных паролей с каждым из имен пользователей-кандидатов. Таким образом, вы можете попытаться применить грубую силу к каждой учетной записи, не вызывая блокировку учетной записи. Вам нужен только один пользователь, чтобы использовать один из трех паролей для взлома учетной записи.

Блокировка учетной записи также не защищает от атак на ввод учетных данных. Это предполагает использование огромного словаря пар *username*:*password*, состоящего из подлинных учетных данных для входа, украденных при утечке данных. Ввод учетных данных основан на том факте, что многие люди повторно используют одно и то же имя пользователя и пароль на нескольких веб-сайтах, и, следовательно, есть вероятность, что некоторые из скомпрометированных учетных данных в словаре также действительны на целевом веб-сайте. Блокировка учетной записи не защищает от ввода учетных данных, поскольку каждое имя пользователя используется только один раз. Вброс учетных данных особенно опасен, поскольку иногда это может привести к тому, что злоумышленник скомпрометирует множество различных учетных записей с помощью одной автоматической атаки.
### Ограничение скорости
Еще один способ, которым веб-сайты пытаются предотвратить атаки грубой силы, - это ограничение скорости пользователей. В этом случае слишком большое количество запросов на вход в систему за короткий промежуток времени приводит к блокировке вашего IP-адреса. Как правило, IP-адрес может быть разблокирован только одним из следующих способов:
* Автоматически по истечении определенного периода времени
* Вручную администратором
* Вручную пользователем после успешного заполнения *КАПЧИ*

Ограничение скорости доступа пользователей иногда предпочтительнее блокировки учетной записи из-за меньшей подверженности перечислению имен пользователей и атакам типа "dos". Однако это все еще не совсем безопасно. Как мы видели в примере из предыдущей лаборатории, существует несколько способов, которыми злоумышленник может манипулировать своим очевидным IP-адресом, чтобы обойти блокировку.

Поскольку ограничение основано на частоте HTTP-запросов, отправляемых с IP-адреса пользователя, иногда также возможно обойти эту защиту, если вы можете понять, как угадать несколько паролей с помощью одного запроса.
## Базовая аутентификация по протоколу HTTP
Хотя он довольно старый, его относительная простота и простота реализации означают, что иногда вы можете увидеть, как используется базовая аутентификация HTTP. При базовой аутентификации HTTP клиент получает маркер аутентификации с сервера, который создается путем объединения имени пользователя и пароля и кодирования его в Base64. Этот токен хранится и управляется браузером, который автоматически добавляет его в заголовок авторизации каждого последующего запроса следующим образом:
*Authorization: Basic base64(username:password)*
По ряду причин это, как правило, не считается безопасным методом аутентификации. Во-первых, это включает в себя повторную отправку учетных данных пользователя при каждом запросе. Если веб-сайт также не реализует *HSTS*, учетные данные пользователя могут быть захвачены в результате атаки *"человек посередине"*.

Кроме того, реализации базовой аутентификации HTTP часто не поддерживают защиту от грубой силы. Поскольку токен состоит исключительно из статических значений, это может сделать его уязвимым для принудительного использования.

Базовая аутентификация HTTP также особенно уязвима для эксплойтов, связанных с сеансами, в частности CSRF, от которых она сама по себе не обеспечивает защиты.

В некоторых случаях использование уязвимой базовой аутентификации HTTP может предоставить злоумышленнику доступ только к, казалось бы, неинтересной странице. Однако, в дополнение к предоставлению дополнительной поверхности для атаки, учетные данные, предоставленные таким образом, могут быть повторно использованы в других, более конфиденциальных контекстах.
