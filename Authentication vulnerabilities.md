# Аутентификационные уязвимости
По крайней мере, концептуально уязвимости аутентификации являются одними из самых простых проблем для понимания. Однако они могут быть одними из наиболее важных из-за очевидной взаимосвязи между аутентификацией и безопасностью. Помимо потенциального предоставления злоумышленникам прямого доступа к конфиденциальным данным и функциям, они также предоставляют дополнительную поверхность атаки для дальнейших эксплойтов. По этой причине изучение того, как выявлять и использовать уязвимости аутентификации, включая способы обхода распространенных мер защиты, является фундаментальным навыком.

В этом разделе мы рассмотрим некоторые из наиболее распространенных механизмов аутентификации, используемых веб-сайтами, и обсудим потенциальные уязвимости в них. Мы выделим как собственные уязвимости в различных механизмах аутентификации, так и некоторые типичные уязвимости, которые возникают из-за их неправильной реализации. Наконец, мы дадим некоторые основные рекомендации о том, как вы можете обеспечить, чтобы ваши собственные механизмы аутентификации были максимально надежными.
![](https://portswigger.net/web-security/images/password-reset-poisoning.svg)

## Что такое аутентификация
Аутентификация-это процесс проверки личности данного пользователя или клиента. Другими словами, она включает в себя проверку того, что они действительно те, за кого себя выдают. По крайней мере частично веб-сайты доступны всем, кто подключен к Интернету по дизайну. Поэтому надежные механизмы аутентификации являются неотъемлемым аспектом эффективной веб-безопасности.

Существует три фактора аутентификации, на которые можно разделить различные типы аутентификации:
* Что-то, что вы **знаете**, например, пароль или ответ на секретный вопрос. Их иногда называют "факторами знаний".
* Что-то, что у вас **есть**, то есть физический объект, такой как мобильный телефон или маркер безопасности. Их иногда называют "факторами владения".
* Что-то, чем вы **являетесь или чем занимаетесь**, например, ваши биометрические данные или модели поведения. Их иногда называют "факторами неотъемлимости".
Механизмы аутентификации полагаются на целый ряд технологий для проверки одного или нескольких из этих факторов.

## Какая разница между аутентификацией и авторизацией
*Аутентификация*-это процесс проверки того, что пользователь действительно **является тем, за кого себя выдает**, в то время как *авторизация* предполагает проверку того, **разрешено ли пользователю что-либо делать**.

В контексте веб-сайта или веб-приложения аутентификация определяет, действительно ли тот, кто пытается получить доступ к сайту с именем пользователя *Carlos123*, является тем же человеком, который создал учетную запись.

После аутентификации *Carlos123* его разрешения определяют, имеет ли он право, например, получать доступ к личной информации о других пользователях или выполнять такие действия, как удаление учетной записи другого пользователя.

## Как возникают уязвимости аутентификации
Вообще говоря, большинство уязвимостей в механизмах аутентификации возникают одним из двух способов:

* Механизмы аутентификации слабы, потому что они не в состоянии должным образом защитить от атак грубой силы.
* Логические недостатки или плохое кодирование в реализации позволяют злоумышленнику полностью обойти механизмы аутентификации. Это иногда называют "сломанной аутентификацией".

Во многих областях веб-разработки логические ошибки просто приведут к неожиданному поведению веб-сайта, что может и не быть проблемой безопасности. Однако, поскольку аутентификация настолько важна для безопасности, вероятность того, что ошибочная логика аутентификации подвергнет веб-сайт проблемам безопасности, явно повышена.
## Какое влияние имеют аутентификационные уязвимости
Влияние уязвимостей аутентификации может быть очень серьезным. Как только злоумышленник либо обойдет аутентификацию, либо грубо проникнет в учетную запись другого пользователя, он получит доступ ко всем данным и функциям, которыми обладает скомпрометированная учетная запись. Если они смогут скомпрометировать учетную запись с высокими привилегиями, такую как системный администратор, они смогут получить полный контроль над всем приложением и потенциально получить доступ к внутренней инфраструктуре.

Даже компрометация учетной записи с низким уровнем привилегий может по-прежнему предоставлять злоумышленнику доступ к данным, которые в противном случае у них не должно было быть, таким как коммерческая конфиденциальная деловая информация. Даже если учетная запись не имеет доступа к каким-либо конфиденциальным данным, она все равно может позволить злоумышленнику получить доступ к дополнительным страницам, которые обеспечивают дополнительную поверхность атаки. Часто некоторые атаки высокой степени серьезности невозможны с общедоступных страниц, но они могут быть возможны с внутренней страницы.
## Уязвимости в механизмах аутентификации
Система аутентификации веб-сайта обычно состоит из нескольких различных механизмов, в которых могут возникать уязвимости. Некоторые уязвимости широко применимы во всех этих контекстах, в то время как другие более специфичны для предоставляемых функций.

Мы более внимательно рассмотрим некоторые из наиболее распространенных уязвимостей в следующих областях:
* Уязвимости входа на основе паролей
* Уязвимости многофакторной аутентификации
* Уязвимости других механизмов аутентификации
## Предотвращение атак на Ваши механизмы аутентификации
Мы продемонстрировали несколько способов, с помощью которых веб-сайты могут быть уязвимы из-за того, как они реализуют аутентификацию. Чтобы снизить риск подобных атак на ваши собственные веб-сайты, существует несколько общих принципов, которым вы всегда должны стараться следовать.
### Как защитить механизм аутентификации
В этом разделе мы поговорим о том, как вы можете предотвратить некоторые из рассмотренных нами уязвимостей в ваших механизмах аутентификации.

Аутентификация-это сложная тема, и, как мы уже продемонстрировали, к сожалению, слишком легко проникнуть в слабые места, имеющие недостатки. Описание всех возможных мер, которые вы можете предпринять для защиты своих собственных веб-сайтов, явно невозможно. Однако есть несколько общих принципов, которым вы всегда должны следовать.
#### Будьте осторожны со своими идентификаторами
Даже самые надежные механизмы аутентификации неэффективны, если вы невольно раскрываете злоумышленнику действительный набор учетных данных для входа. Само собой разумеется, что вы никогда не должны отправлять какие-либо регистрационные данные по незашифрованным соединениям. Хотя вы, возможно, внедрили HTTPS для своих запросов на вход, убедитесь, что вы применяете это, перенаправляя любые попытки HTTP - запросов также на HTTPS.

Вы также должны провести аудит своего веб-сайта, чтобы убедиться, что имя пользователя или адреса электронной почты не раскрываются ни в общедоступных профилях, ни, например, в ответах HTTP.
#### Не расчитывайте на пользовательскую осторожность
Строгие меры аутентификации часто требуют от ваших пользователей некоторых дополнительных усилий. Человеческая природа делает почти неизбежным, что некоторые пользователи найдут способы сэкономить эти усилия. Поэтому вам необходимо обеспечить безопасное поведение везде, где это возможно.

Наиболее очевидным примером является внедрение эффективной политики паролей. Некоторые из более традиционных политик нарушаются, потому что люди вводят в политику свои собственные предсказуемые пароли. Вместо этого может быть более эффективным реализовать какую-либо простую проверку паролей, которая позволяет пользователям экспериментировать с паролями и обеспечивает обратную связь об их надежности в режиме реального времени. Популярным примером является библиотека *JavaScript zxcvbn*, разработанная компанией *Dropbox*. Разрешая использовать только те пароли, которые высоко оценены средством проверки паролей, вы можете обеспечить более эффективное использование безопасных паролей, чем при использовании традиционных политик.
#### Запретите разведку имен пользователей
Злоумышленнику значительно проще взломать ваши механизмы аутентификации, если вы обнаружите, что пользователь существует в системе. Существуют даже определенные ситуации, когда в силу характера веб-сайта информация о том, что у конкретного человека есть учетная запись, сама по себе является конфиденциальной информацией.

Независимо от того, является ли попытка ввести имя пользователя допустимой, важно использовать идентичные общие сообщения об ошибках и убедиться, что они действительно идентичны. Вы всегда должны возвращать один и тот же код состояния HTTP с каждым запросом на вход и, наконец, сделать время отклика в разных сценариях как можно более неразличимым.
#### Внедрите надежную защиту от брутфорса
Учитывая, насколько простым может быть построение атаки методом грубой силы, жизненно важно убедиться, что вы предпринимаете шаги для предотвращения или, по крайней мере, ограничения любых попыток входа в систему методом грубой силы.

Одним из наиболее эффективных методов является внедрение строгого ограничения скорости работы пользователей на основе IP-адресов. Это должно включать меры по предотвращению того, чтобы злоумышленники манипулировали своим очевидным IP-адресом. В идеале вы должны требовать, чтобы пользователь выполнял тест на *КАПЧУ* при каждой попытке входа в систему после достижения определенного предела.

Имейте в виду, что это не гарантирует полного устранения угрозы брутфорса. Однако, делая процесс максимально утомительным и ручным, насколько это возможно, увеличивает вероятность того, что любой потенциальный злоумышленник сдастся и вместо этого отправится на поиски более мягкой цели.
#### Трижды проверьте свою логику верификации
Как показали наши лаборатории, легко внедриться в код, в котором есть простые логические ошибки, которые в случае аутентификации могут полностью скомпрометировать ваш веб-сайт и пользователей. Тщательный аудит любой логики проверки или подтверждения для устранения ошибок является абсолютным ключом к надежной аутентификации. Проверка, которую можно обойти, в конечном счете, не намного лучше, чем отсутствие проверки вообще.
#### Не забывайте о дополнительных функциях
Убедитесь, что вы не просто сосредотачиваетесь на центральных страницах входа и не упускаете из виду дополнительные функции, связанные с аутентификацией. Это особенно важно в тех случаях, когда злоумышленник может свободно зарегистрировать свою собственную учетную запись и изучить эту функциональность. Помните, что сброс или изменение пароля является таким же надежным средством атаки, как и основной механизм входа в систему, и, следовательно, должен быть столь же надежным.
#### Внедрите правильную многофакторную аутентификацию
Хотя многофакторная аутентификация может быть непрактичной для каждого веб-сайта, при правильном выполнении она намного безопаснее, чем только вход на основе пароля. Помните, что проверка нескольких экземпляров одного и того же фактора не является истинной многофакторной аутентификацией. Отправка проверочных кодов по электронной почте - это, по сути, просто более длительная форма однофакторной аутентификации.

*2FA* на основе SMS технически проверяет два фактора (то, что вы знаете, и то, что у вас есть). Однако возможность злоупотреблений, например, при обмене SIM-картами, означает, что эта система может быть ненадежной.

В идеале *2FA* следует реализовать с помощью специального устройства или приложения, которое напрямую генерирует проверочный код. Поскольку они специально созданы для обеспечения безопасности, они, как правило, более безопасны.

Наконец, как и в случае с основной логикой аутентификации, убедитесь, что логика в ваших проверках *2FA* является надежной, чтобы ее было нелегко обойти.
