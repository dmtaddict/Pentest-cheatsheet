# Уязвимости в других механизмах аутентификации
В дополнение к основным функциям входа в систему большинство веб-сайтов предоставляют дополнительные функции, позволяющие пользователям управлять своей учетной записью. Например, пользователи обычно могут изменить свой пароль или сбросить его, если они его забудут. Эти механизмы также могут создавать уязвимости, которыми может воспользоваться злоумышленник.

Веб-сайты обычно стараются избегать хорошо известных уязвимостей на своих страницах входа в систему. Но легко упустить из виду тот факт, что вам необходимо предпринять аналогичные шаги, чтобы гарантировать, что соответствующие функции будут столь же надежными. Это особенно важно в тех случаях, когда злоумышленник может создать свою собственную учетную запись и, следовательно, имеет легкий доступ к изучению этих дополнительных страниц.
## Сохранение состояния входа пользователей в систему
Общей особенностью является возможность оставаться в системе даже после закрытия сеанса браузера. Обычно это простой флажок с надписью что-то вроде "Запомнить меня" или "Оставаться в системе".

Эта функция часто реализуется путем создания какого-либо токена "запомни меня", который затем сохраняется в постоянном файле cookie. Поскольку обладание этим файлом cookie эффективно позволяет вам обойти весь процесс входа в систему, лучше всего, чтобы этот файл cookie было непрактично угадывать. Однако некоторые веб-сайты генерируют этот файл cookie на основе предсказуемого объединения статических значений, таких как имя пользователя и метка времени. Некоторые даже используют пароль как часть файла cookie. Этот подход особенно опасен, если злоумышленник может создать свою собственную учетную запись, потому что он может изучить свой собственный файл cookie и потенциально определить, как он создается. Как только они разработают формулу, они могут попытаться взломать файлы cookie других пользователей, чтобы получить доступ к своим учетным записям.

Некоторые веб-сайты предполагают, что если файл cookie каким-либо образом зашифрован, его невозможно будет угадать, даже если он использует статические значения. Хотя это может быть правдой, если все сделано правильно, наивное "шифрование" файла cookie с использованием простой двусторонней кодировки, такой как Base64, не обеспечивает никакой защиты. Даже использование правильного шифрования с односторонней хэш-функцией не является полностью пуленепробиваемым. Если злоумышленник способен легко идентифицировать алгоритм хеширования, и соль не используется, он потенциально может принудительно удалить файл cookie, просто хешируя свои списки слов. Этот метод можно использовать для обхода ограничений на попытки входа в систему, если аналогичное ограничение не применяется к предположениям о файлах cookie.

Даже если злоумышленник не сможет создать свою собственную учетную запись, он все равно сможет воспользоваться этой уязвимостью. Используя обычные методы, такие как XSS, злоумышленник может украсть файл cookie другого пользователя "запомни меня" и вывести, как из этого создается файл cookie. Если веб-сайт был создан с использованием платформы с открытым исходным кодом, ключевые детали создания файлов cookie могут быть даже публично задокументированы.

В некоторых редких случаях может оказаться возможным получить фактический пароль пользователя в виде открытого текста из файла cookie, даже если он хэширован. Хэшированные версии хорошо известных списков паролей доступны в Интернете, поэтому, если пароль пользователя появляется в одном из этих списков, расшифровка хэша иногда может быть такой же тривиальной, как просто вставка хэша в поисковую систему. Это демонстрирует важность соли в эффективном шифровании.
## Сброс паролей пользователей
На практике считается, что некоторые пользователи забудут свой пароль, поэтому обычно у них есть способ его сбросить. Поскольку обычная аутентификация на основе пароля, очевидно, невозможна в этом сценарии, веб-сайтам приходится полагаться на альтернативные методы, чтобы убедиться, что реальный пользователь сбрасывает свой собственный пароль. По этой причине функция сброса пароля по своей сути опасна и должна быть реализована безопасно.

Существует несколько различных способов, которыми обычно реализуется эта функция, с различной степенью уязвимости.
### Отправка паролей по электронной почте
Само собой разумеется, что отправка пользователям их текущего пароля никогда не должна быть возможной, если веб-сайт в первую очередь надежно обрабатывает пароли. Вместо этого некоторые веб-сайты генерируют новый пароль и отправляют его пользователю по электронной почте.

Вообще говоря, следует избегать отправки постоянных паролей по небезопасным каналам. В этом случае безопасность зависит либо от сгенерированного пароля, срок действия которого истекает через очень короткий промежуток времени, либо от того, что пользователь немедленно снова меняет свой пароль. В противном случае этот подход очень восприимчив к атакам "человек посередине".

Электронная почта также, как правило, не считается безопасной, учитывая, что почтовые ящики являются постоянными и на самом деле не предназначены для безопасного хранения конфиденциальной информации. Многие пользователи также автоматически синхронизируют свой почтовый ящик между несколькими устройствами по небезопасным каналам.
### Сброс паролей с помощью URL-адреса
Более надежный способ сброса паролей - отправить пользователям уникальный URL-адрес, который приведет их на страницу сброса пароля. Менее безопасные реализации этого метода используют URL-адрес с легко угадываемым параметром, чтобы определить, какая учетная запись сбрасывается, например:
> http://vulnerable-website.com/reset-password?user=victim-user

В этом примере злоумышленник может изменить параметр пользователя, чтобы ссылаться на любое имя пользователя, которое он идентифицировал. Затем они будут перенаправлены прямо на страницу, где они потенциально могут установить новый пароль для этого произвольного пользователя.

Лучшей реализацией этого процесса является создание маркера с высокой энтропией, который трудно угадать, и создание URL-адреса сброса на его основе. В лучшем случае этот URL-адрес не должен содержать никаких подсказок о том, какой пароль пользователя сбрасывается.
> http://vulnerable-website.com/reset-password?token=a0ba0d1cb3b63d13822572fcff1a241895d893f659164d4cc550b421ebdd48a8

Когда пользователь посещает этот URL-адрес, система должна проверить, существует ли этот токен на серверной части, и если да, то пароль какого пользователя он должен сбросить. Этот токен должен истечь через короткий промежуток времени и быть уничтожен сразу же после сброса пароля.

Однако некоторые веб-сайты также не могут повторно проверить маркер при отправке формы сброса. В этом случае злоумышленник может просто зайти в форму сброса из своей учетной записи, удалить токен и использовать эту страницу для сброса пароля произвольного пользователя.

Если URL-адрес в электронном письме для сброса генерируется динамически, он также может быть уязвим для **отравления сброса пароля**. В этом случае злоумышленник потенциально может украсть токен другого пользователя и с его помощью изменить свой пароль.
>[Отравление сброса пароля](Password%20reset%20poisoning.md)

## Изменение паролей пользователей
Как правило, смена пароля включает в себя ввод текущего пароля, а затем нового пароля дважды. Эти страницы в основном основаны на том же процессе проверки соответствия имен пользователей и текущих паролей, что и обычная страница входа в систему. Следовательно, эти страницы могут быть уязвимы для тех же методов.

Функция смены пароля может быть особенно опасной, если она позволяет злоумышленнику получить к ней прямой доступ, не входя в систему как пользователь-жертва. Например, если имя пользователя указано в скрытом поле, злоумышленник может изменить это значение в запросе, предназначенном для произвольных пользователей. Это потенциально может быть использовано для перечисления имен пользователей и паролей методом грубой силы.
